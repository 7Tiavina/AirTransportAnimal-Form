<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATA - Animal Transport Application</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js@10.2.0/public/assets/styles/choices.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/css/intlTelInput.css">
    <link rel="alternate" hreflang="en" href="https://airtransportanimal.online/en/" />
    <link rel="alternate" hreflang="fr" href="https://airtransportanimal.online/fr/" />
    <link rel="alternate" hreflang="x-default" href="https://airtransportanimal.online/" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        :root {
            --primary-color: #9EA465;
            --primary-dark: #8a8f5a;
            --primary-hover: #357abd;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --text-color: #2d3436;
            --text-light: #636e72;
            --bg-light: #f8f9fa;
            --border-color: #dfe6e9;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-hover: 0 8px 30px rgba(0,0,0,0.12);
            --radius: 12px;
            --radius-sm: 8px;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #9EA465 0%, #8a8f5a 100%) !important;
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 750px;
        }
        .logo {
            margin-bottom: 20px;
            text-align: center;
        }
        .logo img {
            max-width: 280px;
            height: auto;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }
        .form-container {
            background: #ffffff;
            padding: 40px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 100%;
            transition: box-shadow 0.3s ease;
        }
        .form-container:hover {
            box-shadow: var(--shadow-hover);
        }
        h2 {
            text-align: center;
            color: var(--text-color);
            margin-bottom: 1rem;
            font-size: 1.75rem;
            font-weight: 600;
        }
        h3 {
            color: var(--primary-color);
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            font-weight: 600;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--bg-light);
        }
        .page { display: none; animation: fadeIn 0.3s ease; }
        #page-1 { display: block; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .title-label {
            font-size: 0.95rem;
            font-weight: 600;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            display: block;
            color: var(--text-color);
        }
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        select,
        textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            background-color: var(--bg-light);
            font-family: inherit;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="tel"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            background-color: #fff;
            box-shadow: 0 0 0 3px rgba(158,164,101,0.1);
        }
        input.error, select.error, textarea.error {
            border-color: var(--danger-color);
            background-color: #fff5f5;
        }
        .error-message {
            color: var(--danger-color);
            font-size: 0.85rem;
            margin-top: 0.25rem;
            display: none;
        }
        .error-message.show { display: block; }
        .checkbox-group {
            display: flex;
            align-items: flex-start;
            margin: 1.5rem 0;
            padding: 1rem;
            background: var(--bg-light);
            border-radius: var(--radius-sm);
        }
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            margin-top: 2px;
            flex-shrink: 0;
            cursor: pointer;
        }
        .checkbox-group label {
            font-size: 0.9rem;
            line-height: 1.5;
            cursor: pointer;
        }
        button {
            padding: 14px 32px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .btn-next, .btn-submit {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
        }
        .btn-prev {
            background-color: var(--bg-light);
            color: var(--text-color);
            border: 2px solid var(--border-color);
        }
        .pet-form {
            border: 2px solid var(--border-color);
            padding: 1.5rem;
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
            background: #fff;
            transition: all 0.3s ease;
        }
        .pet-form:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 15px rgba(158,164,101,0.1);
        }
        .pet-form h4 {
            margin: 0 0 1rem 0;
            color: var(--primary-color);
            font-size: 1.1rem;
            font-weight: 600;
        }
        .page-1-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        .page-1-left {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }
        .btn-add-pet {
            background-color: #2d3436;
            color: white;
            padding: 12px 24px;
            font-size: 0.9rem;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn-add-pet:hover {
            background-color: #000;
        }
        .btn-add-pet:disabled {
            background-color: #b2bec3;
        }
        .btn-remove-pet {
            background-color: #fff;
            color: var(--danger-color);
            border: 2px solid var(--danger-color);
            padding: 8px 16px;
            font-size: 0.85rem;
            border-radius: 50px;
        }
        .btn-remove-pet:hover {
            background-color: var(--danger-color);
            color: white;
        }
        .pet-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        .page-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--bg-light);
        }
        .radio-group {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1rem;
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            background: #fff;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .radio-group:hover {
            border-color: var(--primary-color);
            background: #fafbf7;
        }
        .radio-group input[type="radio"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            margin-top: 2px;
            flex-shrink: 0;
            cursor: pointer;
            accent-color: var(--primary-color);
        }
        .radio-group label {
            cursor: pointer;
            width: 100%;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        .radio-group input[type="radio"]:checked + label {
            color: var(--primary-color);
            font-weight: 600;
        }
        .limit-message {
            display: none;
            margin: 1.5rem 0;
            padding: 1.25rem;
            background-color: #fff3cd;
            border: 2px solid var(--warning-color);
            border-radius: var(--radius-sm);
            text-align: center;
        }
        .limit-message strong {
            color: #856404;
            display: block;
            margin-bottom: 0.5rem;
        }
        .limit-message p {
            margin: 0;
            color: #856404;
            font-size: 0.9rem;
        }
        .limit-message a {
            color: #856404;
            font-weight: 600;
        }
        .form-hint {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }
        .iti { width: 100%; }
        .iti__flag { background-image: url("https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/img/flags.png"); }
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .iti__flag { background-image: url("https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/img/flags@2x.png"); }
        }
        .pac-container {
            border-radius: 8px !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15) !important;
            border: 1px solid #dfe6e9 !important;
            font-family: 'Poppins', sans-serif !important;
            font-size: 0.95rem !important;
            z-index: 9999 !important;
        }
        .pac-container .pac-item {
            padding: 10px 15px !important;
            cursor: pointer !important;
        }
        .pac-container .pac-item:hover {
            background-color: #f8f9fa !important;
        }
        .pac-container .pac-item-selected {
            background-color: #f0f1f2 !important;
        }
        .pac-container .pac-icon {
            margin-top: 5px !important;
        }
        @media (max-width: 600px) {
            .form-container { padding: 25px 20px; }
            h2 { font-size: 1.4rem; }
            .page-1-actions { flex-direction: column; }
            .page-1-left { width: 100%; justify-content: center; }
            .btn-add-pet { width: 100%; justify-content: center; }
            .page-navigation { flex-direction: column-reverse; }
            .page-navigation button { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="logo">
            <a href="index.html">
                <img src="ATA-logo.png" alt="Air Transport Animal Logo">
            </a>
        </div>
        <div class="form-container">
            <form id="pet-form" novalidate>
                <input type="hidden" id="pet-count" name="pet_count" value="1">

                <!-- PAGE 1: Pet Information -->
                <div id="page-1" class="page">
                    <h2>Obtenez votre estimation tarifaire personnalis√©e</h2>
                    <p style="text-align: center; color: var(--text-light);">
                        Dites-nous-en un peu plus sur votre projet pour que nous puissions analyser pr√©cis√©ment votre demande et vous proposer une estimation adapt√©e.<br>
                        <strong>Un de nos experts vous fera un retour sous 48h00 !</strong>
                    </p>
                    <p style="text-align: center;"><strong>C'est simple, gratuit et sans engagement.</strong></p>

                    <div id="pet-forms-container"></div>

                    <div id="pet-limit-message" class="limit-message">
                        <strong>‚ö†Ô∏è Maximum 9 Animaux</strong>
                        <p>
                            Vous avez atteint la limite maximale de 9 animaux pour les demandes en ligne.<br>
                            Pour les demandes avec plus de 9 animaux, veuillez nous contacter directement par email √†<br>
                            <a href="mailto:contact@airtransportanimal.online">contact@airtransportanimal.online</a>
                        </p>
                    </div>

                    <div class="page-1-actions">
                        <div class="page-1-left">
                            <button type="button" class="btn-add-pet" id="add-pet-btn">
                                <span>‚ûï Ajouter un Animal</span>
                            </button>
                        </div>
                        <button type="button" class="btn-next" id="next-page-1-btn">
                            <span>Suivant ‚Üí</span>
                        </button>
                    </div>
                </div>

                <!-- PAGE 2: Transport Project -->
                <div id="page-2" class="page" style="display: none;">
                    <h2>Votre Projet de Transport</h2>
                    <p style="text-align: center; color: var(--text-light);">Dites-nous quel est votre projet ?</p>

                    <h3>D√©part</h3>

                    <label class="title-label" for="departure-street">Adresse <span style="color: var(--danger-color);">*</span></label>
                    <input type="text" id="departure-street" name="departure-street" placeholder="Num√©ro et nom de rue" autocomplete="off" required>
                    <span class="form-hint">Num√©ro et nom de rue</span>

                    <label class="title-label" for="departure-city">Ville <span style="color: var(--danger-color);">*</span></label>
                    <input type="text" id="departure-city" name="departure-city" placeholder="Ville" autocomplete="off" required>

                    <label class="title-label" for="departure-country">Pays <span style="color: var(--danger-color);">*</span></label>
                    <select id="departure-country" name="departure-country" required></select>

                    <h3>Destination</h3>

                    <label class="title-label" for="destination-street">Adresse <span style="color: var(--danger-color);">*</span></label>
                    <input type="text" id="destination-street" name="destination-street" placeholder="Num√©ro et nom de rue" autocomplete="off" required>

                    <label class="title-label" for="destination-city">Ville <span style="color: var(--danger-color);">*</span></label>
                    <input type="text" id="destination-city" name="destination-city" placeholder="Ville" autocomplete="off" required>

                    <label class="title-label" for="destination-country">Pays <span style="color: var(--danger-color);">*</span></label>
                    <select id="destination-country" name="destination-country" required></select>

                    <label class="title-label" for="departure-date">Quand souhaitez-vous faire voyager vos animaux ? <span style="color: var(--danger-color);">*</span></label>
                    <select id="departure-date" name="departure-date" required>
                        <option value="">-- Choisissez une option --</option>
                        <option value="1-month">Dans 1 mois</option>
                        <option value="1-3-months">Dans 1 √† 3 mois</option>
                        <option value="3-plus-months">Au-del√† de 3 mois</option>
                        <option value="under-consideration">Projet en cours de r√©flexion</option>
                    </select>

                    <div class="page-navigation">
                        <button type="button" class="btn-prev" id="prev-page-2-btn">
                            <span>‚Üê Pr√©c√©dent</span>
                        </button>
                        <button type="button" class="btn-next" id="next-page-2-btn">
                            <span>Suivant ‚Üí</span>
                        </button>
                    </div>
                </div>

                <!-- PAGE 3: Travel Conditions -->
                <div id="page-3" class="page" style="display: none;">
                    <h2>Conditions de Voyage</h2>

                    <div id="travel-options-group">
                        <label class="title-label" for="travel-option">Souhaitez-vous que l'animal voyage : <span style="color: var(--danger-color);">*</span></label>
                        <select id="travel-option" name="travel-option" required>
                            <option value="">-- Choisissez une option --</option>
                            <option value="alone">Seul (Fret A√©rien)</option>
                            <option value="with-you-cabin">Avec vous - en cabine</option>
                            <option value="with-you-hold">Avec vous - en soute</option>
                        </select>

                        <div id="context-field" style="display: none;">
                            <label class="title-label" style="margin-top: 1.5rem;">Contexte:</label>

                            <div class="radio-group">
                                <input type="radio" id="context-breeding" name="context" value="breeding" required>
                                <label class="title-label" for="context-breeding">
                                    <strong>Transport pour √©levage</strong><br>
                                    <span style="font-size: 0.85em; color: var(--text-light);">Vous organisez le transport d'un ou plusieurs animaux dans le cadre d'une activit√© d'√©levage (vente, reproduction, concours...)</span>
                                </label>
                            </div>

                            <div class="radio-group">
                                <input type="radio" id="context-mobility" name="context" value="mobility">
                                <label class="title-label" for="context-mobility">
                                    <strong>Mobilit√© Internationale / Expatriation</strong><br>
                                    <span style="font-size: 0.85em; color: var(--text-light);">Le transport s'inscrit dans un d√©m√©nagement professionnel ou familial vers l'√©tranger (mutation, installation, retour...)</span>
                                </label>
                            </div>

                            <div class="radio-group">
                                <input type="radio" id="context-joining-owner" name="context" value="joining-owner">
                                <label class="title-label" for="context-joining-owner">
                                    <strong>Rejoindre le propri√©taire √† destination</strong><br>
                                    <span style="font-size: 0.85em; color: var(--text-light);">Le propri√©taire est d√©j√† install√© sur place, et l'animal le rejoint</span>
                                </label>
                            </div>

                            <div class="radio-group">
                                <input type="radio" id="context-others" name="context" value="others">
                                <label class="title-label" for="context-others"><strong>Autre</strong></label>
                            </div>

                            <div id="other-means-field" style="display: none;">
                                <label class="title-label" for="other-context-text">Pr√©cisez le contexte:</label>
                                <input type="text" id="other-context-text" name="other-context-text">
                            </div>
                        </div>
                    </div>

                    <label class="title-label" for="additional-info" style="margin-top: 1.5rem; display: block;">
                        Aidez-nous √† vous r√©pondre au mieux.<br>
                        <span style="font-size: 0.85em; color: var(--text-light);">Quelques d√©tails suppl√©mentaires (contraintes, souhaits particuliers...) qui nous permettront de vous proposer la solution la plus adapt√©e.</span>
                    </label>
                    <textarea id="additional-info" name="additional-info" rows="4" placeholder="Ex: 2 chiens brachyc√©phales, besoin assistance documents v√©t√©rinaires" style="margin-top: 0.5rem;"></textarea>

                    <div class="page-navigation">
                        <button type="button" class="btn-prev" id="prev-page-3-btn">
                            <span>‚Üê Pr√©c√©dent</span>
                        </button>
                        <button type="button" class="btn-next" id="next-page-3-btn">
                            <span>Suivant ‚Üí</span>
                        </button>
                    </div>
                </div>

                <!-- PAGE 4: Contact Information -->
                <div id="page-4" class="page" style="display: none;">
                    <h2>Coordonn√©es</h2>

                    <label class="title-label" for="first-name">Pr√©nom <span style="color: var(--danger-color);">*</span></label>
                    <input type="text" id="first-name" name="first-name" required>

                    <label class="title-label" for="last-name">Nom <span style="color: var(--danger-color);">*</span></label>
                    <input type="text" id="last-name" name="last-name" required>

                    <label class="title-label" for="email">Adresse Email <span style="color: var(--danger-color);">*</span></label>
                    <input type="email" id="email" name="email" required>

                    <label class="title-label" for="phone">Num√©ro de T√©l√©phone <span style="color: var(--danger-color);">*</span></label>
                    <input type="tel" id="phone" name="phone" required>

                    <label class="title-label" for="whatsapp">Num√©ro WhatsApp (Optionnel)</label>
                    <input type="tel" id="whatsapp" name="whatsapp">

                    <div class="checkbox-group">
                        <input type="checkbox" id="consent" name="consent" required>
                        <label class="title-label" for="consent">J'ai lu et j'accepte les Conditions G√©n√©rales et les Politiques de Confidentialit√©.</label>
                    </div>

                    <div class="page-navigation">
                        <button type="button" class="btn-prev" id="prev-page-4-btn">
                            <span>‚Üê Pr√©c√©dent</span>
                        </button>
                        <button type="submit" class="btn-submit">
                            <span>Soumettre ‚úì</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/choices.js@10.2.0/public/assets/scripts/choices.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/js/intlTelInput.min.js"></script>
    <script>
        const GOOGLE_MAPS_API_KEY = 'AIzaSyBjKhgSQJCEzQUgqUQHqb-hEYawV4Eojp0';

        const originalWarn = console.warn;
        console.warn = function(...args) {
            const message = args.join(' ');
            if (message.includes('Google Maps JavaScript API has been loaded directly without loading=async') ||
                message.includes('google.maps.places.Autocomplete is not available to new customers')) { return; }
            originalWarn.apply(console, args);
        };
        const script = document.createElement('script');
        script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&libraries=places`;
        script.async = true;
        script.defer = true;
        document.head.appendChild(script);
    </script>
    <script>
document.addEventListener('DOMContentLoaded', () => {
    const currentLang = 'fr';
    const choiceOptions = { searchEnabled: true, itemSelectText: '', shouldSort: false, allowHTML: false };

    const qualifiedDogsFR = [
        "Affenpinscher", "A√Ødi", "Akita Am√©ricain", "Akita Inu", "American Bully", "American Staffordshire Terrier",
        "Barzo√Ø", "Basenji", "Basset Hound", "Beagle", "Beauceron", "Berger d'Anatolie", "Berger Allemand", "Berger Australien", "Berger Belge", "Berger Catalan", "Berger Cr√©ole", "Berger de Picardie", "Berger des Shetland", "Berger du Caucase",
        "Bichon Fris√©", "Bichon Maltais", "Bleu de Gascogne", "Bleu Russe", "Bobtail", "Bobtail Am√©ricain", "Bobtail des Kouriles", "Bobtail du M√©kong", "Boerboel", "Bombay", "Border Collie", "Border Terrier", "Boston Terrier", "Bouledogue Anglais", "Bouledogue Fran√ßais", "Bouvier Bernois", "Bouvier d'Appenzell", "Bouvier des Ardennes", "Bouvier des Flandres", "Boxer", "Braque Allemand √† Poil Court", "Braque Allemand √† Poil Dur", "Braque de Weimar", "Briard", "Broholmer", "Bull Terrier", "Bullmastiff",
        "Cairn Terrier", "Caniche", "Caniche Moyen", "Caniche Standard", "Caniche Toy", "Cane Corso", "Carlin", "Cavalier King Charles", "Chartreux", "Chien de Berger Islandais", "Chien de Montagne des Pyr√©n√©es", "Chien de Saint-Hubert", "Chien d'Eau Portugais", "Chien-loup Tch√©coslovaque", "Chihuahua", "Chihuahua Apple Head", "Chihuahua Deer Head", "Chow Chow", "Cocker Spaniel", "Colley", "Colley √† poil long", "Cornish Rex", "Coton de Tul√©ar", "Cymric",
        "Dalmatien", "Devon Rex", "Doberman", "Dogue Allemand", "Dogue Argentin", "Dogue de Bordeaux", "Dogue de Majorque", "Dogue des Canaries", "Dogue du Tibet",
        "√âpagneul (divers types)", "√âpagneul Breton", "√âpagneul de Picardie", "√âpagneul Japonais", "√âpagneul Tib√©tain",
        "Fila Brasileiro", "Fox-terrier", "Fran√ßais Tricolore",
        "G√©ant des Flandres", "Golden Retriever", "Grand Bouvier Suisse", "Griffon Bruxellois", "Gris du Gabon",
        "Highland Fold", "Himalayen", "Husky de Sib√©rie",
        "Ins√©parable",
        "Jack Russell Terrier",
        "King Charles Spaniel", "Komondor", "Kooikerhondje",
        "Labrador Retriever", "LaPerm", "L√©vrier", "L√©vrier Italien", "Lhassa Apso", "Leonberger", "Lori", "Loulou de Pom√©ranie", "Lykoi",
        "Maine Coon", "Malinois", "M√¢tin", "M√¢tin de Naples", "M√¢tin des Pyr√©n√©es", "M√¢tin Espagnol", "Manx", "Mau √âgyptien", "Mudi",
        "Nebelung", "Neva Masquerade",
        "Ocicat", "Oriental",
        "Papillon Anglais", "Persan", "Peterbald", "P√©kinois", "Perruche √† Collier", "Perruche Ondul√©e", "Pinscher", "Pointer", "Pointer Anglais", "Polonais de Plaine", "Pomeranian",
        "Ragamuffin", "Ragdoll", "Rat Domestique", "Rex Allemand", "Rex de Boh√™me", "Rhodesian Ridgeback", "Rottweiler",
        "Sacr√© de Birmanie", "Saint-Bernard", "Samoy√®de", "Savannah", "Schipperke", "Schnauzer (G√©ant)", "Schnauzer (Nain)", "Schnauzer (Standard)", "Scottish Fold", "Selkirk Rex", "Serpent", "Shar-Pei", "Shiba Inu", "Shih Tzu", "Siamois", "Sib√©rien", "Singapura", "Skye Terrier", "Smoushond Hollandais", "Smooth Fox Terrier", "Snowshoe", "Soft Coated Wheaten Terrier", "Sokoke", "Somali", "Spinone Italiano", "Spitz Allemand", "Spitz Finlandais", "Spitz Japonais", "Sphynx", "Staffordshire Bull Terrier", "Sussex Spaniel", "Swedish Vallhund",
        "Teckel", "Terre-neuve", "Terrier Australien", "Terrier de Boston", "Terrier de Norfolk", "Terrier √âcossais", "Terrier Gallois", "Terrier Japonais", "Terrier Soyeux", "Tha√Ø", "Tiffanie", "Tonkinois", "Tosa Inu", "Tortue", "Toyger",
        "Vizsla", "Volpino Italien",
        "Welsh Corgi (Cardigan)", "Welsh Corgi (Pembroke)", "West Highland White Terrier", "Whippet", "Wire Fox Terrier",
        "Yorkshire Terrier",
        "Autres"
    ];

    const qualifiedCatsFR = [
        "Abyssin", "Balinais", "Bengal", "Birman (Sacr√© de Birmanie)", "Bobtail Am√©ricain", "Bombay", "British Longhair", "British Shorthair", "Burmese", "Burmilla", "Chartreux", "Cornish Rex", "Devon Rex", "Europ√©en", "Exotic Fold", "Exotic Shorthair", "Himalayen", "Maine Coon", "Manx", "Mau √âgyptien", "Nebelung", "Norwegian Forest Cat", "Ocicat", "Oriental", "Persan", "Ragdoll", "Rex Allemand", "Russe (Bleu Russe)", "Sacr√© de Birmanie", "Savannah", "Scottish Fold", "Selkirk Rex", "Siamois", "Sib√©rien", "Singapura", "Somali", "Sphynx", "Tha√Ø", "Tonkinois", "Turc de Van",
        "Autres"
    ];

    const dogBreedsFR = [
        "Affenpinscher", "Airedale Terrier", "A√Ødi", "Akita Am√©ricain", "Akita Inu", "Alaskan Malamute", "American Bully", "American Staffordshire Terrier",
        "Barzo√Ø", "Basenji", "Basset Hound", "Beagle", "Beauceron", "Berger d'Anatolie", "Berger Allemand", "Berger Australien", "Berger Belge", "Berger Catalan", "Berger Cr√©ole", "Berger de Picardie", "Berger des Shetland", "Berger du Caucase",
        "Bichon Fris√©", "Bichon Maltais", "Bleu de Gascogne", "Bobtail", "Boerboel", "Border Collie", "Border Terrier", "Boston Terrier", "Bouledogue Anglais", "Bouledogue Fran√ßais", "Bouvier Bernois", "Bouvier d'Appenzell", "Bouvier des Ardennes", "Bouvier des Flandres", "Boxer", "Braque Allemand √† Poil Court", "Braque Allemand √† Poil Dur", "Braque de Weimar", "Briard", "Broholmer", "Bull Terrier", "Bullmastiff",
        "Cairn Terrier", "Caniche", "Caniche Moyen", "Caniche Standard", "Caniche Toy", "Cane Corso", "Carlin", "Cavalier King Charles", "Chien de Berger Islandais", "Chien de Montagne des Pyr√©n√©es", "Chien de Saint-Hubert", "Chien d'Eau Portugais", "Chien-loup Tch√©coslovaque", "Chihuahua", "Chihuahua Apple Head", "Chihuahua Deer Head", "Chow Chow", "Cocker Spaniel", "Colley", "Coton de Tul√©ar", "Cymric",
        "Dalmatien", "Devon Rex", "Doberman", "Dogue Allemand", "Dogue Argentin", "Dogue de Bordeaux", "Dogue de Majorque", "Dogue des Canaries", "Dogue du Tibet",
        "√âpagneul (divers types)", "√âpagneul Breton", "√âpagneul de Picardie", "√âpagneul Japonais", "√âpagneul Tib√©tain",
        "Fila Brasileiro", "Fox-terrier", "Fran√ßais Tricolore",
        "Golden Retriever", "Grand Bouvier Suisse", "Griffon Bruxellois", "G√©ant des Flandres",
        "Highland Fold", "Himalayen", "Husky de Sib√©rie",
        "Jack Russell Terrier",
        "King Charles Spaniel", "Komondor", "Kooikerhondje",
        "Labrador Retriever", "LaPerm", "L√©vrier", "L√©vrier Italien", "Lhassa Apso", "Leonberger", "Loulou de Pom√©ranie", "Lykoi",
        "Maine Coon", "Malinois", "M√¢tin", "M√¢tin de Naples", "M√¢tin des Pyr√©n√©es", "M√¢tin Espagnol", "Manx", "Mudi",
        "Nebelung", "Neva Masquerade",
        "Ocicat", "Oriental",
        "Papillon Anglais", "Persan", "Peterbald", "P√©kinois", "Pinscher", "Pointer", "Pointer Anglais", "Polonais de Plaine", "Pomeranian",
        "Ragamuffin", "Ragdoll", "Rex Allemand", "Rhodesian Ridgeback", "Rottweiler",
        "Saint-Bernard", "Samoy√®de", "Savannah", "Schipperke", "Schnauzer (G√©ant)", "Schnauzer (Nain)", "Schnauzer (Standard)", "Scottish Fold", "Selkirk Rex", "Shar-Pei", "Shiba Inu", "Shih Tzu", "Siamois", "Sib√©rien", "Singapura", "Skye Terrier", "Smoushond Hollandais", "Smooth Fox Terrier", "Snowshoe", "Soft Coated Wheaten Terrier", "Sokoke", "Somali", "Spinone Italiano", "Spitz Allemand", "Spitz Finlandais", "Spitz Japonais", "Sphynx", "Staffordshire Bull Terrier", "Sussex Spaniel", "Swedish Vallhund",
        "Teckel", "Terre-neuve", "Terrier Australien", "Terrier de Boston", "Terrier de Norfolk", "Terrier √âcossais", "Terrier Gallois", "Terrier Japonais", "Terrier Soyeux", "Tha√Ø", "Tiffanie", "Tonkinois", "Tosa Inu", "Toyger",
        "Vizsla", "Volpino Italien",
        "Welsh Corgi (Cardigan)", "Welsh Corgi (Pembroke)", "West Highland White Terrier", "Whippet", "Wire Fox Terrier",
        "Yorkshire Terrier",
        "Autres"
    ];

    const catBreedsFR = [
        "Abyssin", "American Curl", "American Shorthair", "American Wirehair", "Angora Turc", "Asian", "Australian Mist",
        "Balinais", "Bengal", "Birman (Sacr√© de Birmanie)", "Bobtail Am√©ricain", "Bobtail des Kouriles", "Bobtail du M√©kong", "Bombay", "British Longhair", "British Shorthair", "Burmese", "Burmilla",
        "Californian Rex", "Chartreux", "Cornish Rex", "Cymric",
        "Devon Rex", "Donskoy",
        "Europ√©en", "Exotic Fold", "Exotic Shorthair",
        "Himalayen", "Highland Fold",
        "Korat",
        "LaPerm", "Lykoi",
        "Maine Coon", "Manx", "Mau √âgyptien", "Munchkin",
        "Nebelung", "Neva Masquerade", "Norwegian Forest Cat (Chat des For√™ts Norv√©giennes)",
        "Ocicat", "Oriental",
        "Persan", "Peterbald",
        "Ragamuffin", "Ragdoll", "Rex Allemand", "Rex de Boh√™me", "Russe (Bleu Russe)",
        "Sacr√© de Birmanie", "Savannah", "Scottish Fold", "Selkirk Rex", "Siamois", "Sib√©rien", "Singapura", "Snowshoe", "Sokoke", "Somali", "Sphynx",
        "Tha√Ø", "Tiffanie", "Tonkinois", "Toyger", "Turc de Van",
        "Autres"
    ];

    const nacBreeds = ["Autres", "Chinchilla", "Cochon d'Inde", "Furet", "Gecko", "L√©zard", "Rat Domestique", "Salamandre", "Serpent", "Tortue"];
    const birdBreeds = ["Ara", "Autres", "Cacato√®s", "Ca√Øque", "Canari", "Conure", "√âclectus", "Gris du Gabon", "Ins√©parable", "Lori", "Perroquet Amazonien", "Perruche √† Collier", "Perruche Ondul√©e"];
    const rabbitBreeds = ["Autres", "Fauve de Bourgogne", "G√©ant Blanc du Bouscat", "G√©ant des Flandres", "Lapin Angora Nain", "Lapin Hollandais", "Lapin Nain B√©lier", "Lapin Nain de Couleur", "Lapin T√™te de Lion", "Normand", "Papillon Anglais"];

    const breedsFR = {
        'Cat': catBreedsFR,
        'Dog': dogBreedsFR,
        'NAC': nacBreeds,
        'Bird': birdBreeds,
        'Rabbit': rabbitBreeds,
        'Others': []
    };

    const qualifiedCountries = ["France", "Mauritius", "Australia", "New Caledonia", "New Zealand", "South Africa", "Ireland", "Wallis and Futuna", "Bahrain", "Hong Kong", "United Kingdom", "French Polynesia", "United Arab Emirates"];

    const countriesFR = [
        "Afghanistan","Afrique du Sud","√éles √Öland","Albanie","Alg√©rie","Allemagne","Samoa Am√©ricaines","Andorre","Angola","Anguilla","Antigua-et-Barbuda","Antilles N√©erlandaises","Arabie Saoudite","Argentine","Arm√©nie","Aruba","Australie","Autriche","Azerba√Ødjan","Bahamas","Bahre√Øn","Bangladesh","Barbade","Belgique","Belize","B√©nin","Bermudes","Bhoutan","Bi√©lorussie","Birmanie (Myanmar)","Bolivie","Bosnie-Herz√©govine","Botswana","Br√©sil","Brunei","Bulgarie","Burkina Faso","Burundi","Cambodge","Cameroun","Canada","Cap-vert","Chili","Chine","Colombie","Comores","Congo","Cor√©e du Nord","Cor√©e du Sud","Costa Rica","C√¥te d'Ivoire","Croatie","Cuba","Danemark","Djibouti","Dominique","√âgypte","√âmirats Arabes Unis","√âquateur","√ârythr√©e","Espagne","Estonie","√âtats F√©d√©r√©s de Micron√©sie","√âtats-Unis","√âthiopie","Fidji","Finlande","France","Gabon","Gambie","G√©orgie","G√©orgie du Sud et les √éles Sandwich du Sud","Ghana","Gibraltar","Gr√®ce","Grenade","Groenland","Guadeloupe","Guam","Guatemala","Guin√©e","Guin√©e √âquatoriale","Guin√©e-Bissau","Guyana","Guyane Fran√ßaise","Ha√Øti","Honduras","Hong-Kong","Hongrie","√éle Christmas","√éle de Man","√éle Norfolk","√éles Ca√Ømans","√éles Cocos (Keeling)","√éles Cook","√éles F√©ro√©","√éles Malouines","√éles Mariannes du Nord","√éles Marshall","√éles Pitcairn","√éles Turks et Ca√Øques","√éles Vierges Britanniques","√éles Vierges des √âtats-Unis","Inde","Indon√©sie","Iran","Iraq","Irlande","Islande","Isra√´l","Italie","Jama√Øque","Japon","Jordanie","Kazakhstan","Kenya","Kirghizistan","Kiribati","Kowe√Øt","Laos","Le Vatican","Lesotho","Lettonie","Liban","Lib√©ria","Libye","Liechtenstein","Lituanie","Luxembourg","Macao","Mac√©doine du Nord","Madagascar","Malaisie","Malawi","Maldives","Mali","Malte","Maroc","Martinique","Maurice","Mauritanie","Mayotte","Mexique","Moldavie","Monaco","Mongolie","Mont√©n√©gro","Montserrat","Mozambique","Namibie","Nauru","N√©pal","Nicaragua","Niger","Nig√©ria","Niu√©","Norv√®ge","Nouvelle-Cal√©donie","Nouvelle-Z√©lande","Oman","Ouganda","Ouzb√©kistan","Pakistan","Palaos","Palestine","Panama","Papouasie-Nouvelle-Guin√©e","Paraguay","Pays-Bas","P√©rou","Philippines","Pologne","Polyn√©sie Fran√ßaise","Porto Rico","Portugal","Qatar","R√©publique Centrafricaine","R√©publique D√©mocratique du Congo","R√©publique Dominicaine","R√©publique du Congo","R√©publique Tch√®que","R√©union","Roumanie","Royaume-Uni","Russie","Rwanda","Sainte-H√©l√®ne","Sainte-Lucie","Saint-Kitts-et-Nevis","Saint-Marin","Saint-Pierre-et-Miquelon","Saint-Vincent-et-les-Grenadines","Salvador","Samoa","Samoa Am√©ricaines","Sao Tom√©-et-Principe","S√©n√©gal","Serbie","Seychelles","Sierra Leone","Singapour","Slovaquie","Slov√©nie","Somalie","Soudan","Sri Lanka","Su√®de","Suisse","Suriname","Svalbard et Jan Mayen","Swaziland","Syrie","Tadjikistan","Ta√Øwan","Tanzanie","Tchad","Terres Australes Fran√ßaises","Tha√Ølande","Timor Oriental","Togo","Tonga","Trinit√©-et-Tobago","Tunisie","Turkm√©nistan","Turquie","Tuvalu","Ukraine","Uruguay","Vanuatu","Venezuela","Viet Nam","Wallis et Futuna","Y√©men","Zambie","Zimbabwe"
    ];

    const countriesEN = [
        "Afghanistan","√Öland Islands","Albania","Algeria","American Samoa","Andorra","Angola","Anguilla","Antigua and Barbuda","Argentina","Armenia","Aruba","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bermuda","Bhutan","Bolivia","Bosnia and Herzegovina","Botswana","Brazil","British Virgin Islands","Brunei","Bulgaria","Burkina Faso","Burundi","Cabo Verde","Cambodia","Cameroon","Canada","Cayman Islands","Central African Republic","Chad","Chile","China","Christmas Island","Cocos (Keeling) Islands","Colombia","Comoros","Congo","Cook Islands","Costa Rica","Croatia","Cuba","Czech Republic","Democratic Republic of the Congo","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Eswatini","Estonia","Ethiopia","Falkland Islands","Faroe Islands","Federated States of Micronesia","Fiji","Finland","France","French Guiana","French Polynesia","French Southern Territories","Gabon","Gambia","Georgia","Germany","Ghana","Gibraltar","Greece","Greenland","Grenada","Guadeloupe","Guam","Guatemala","Guinea","Guinea-Bissau","Guyana","Haiti","Honduras","Hong Kong","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Isle of Man","Israel","Italy","Ivory Coast","Jamaica","Japan","Jordan","Kazakhstan","Kenya","Kiribati","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Macao","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Martinique","Mauritania","Mauritius","Mayotte","Mexico","Moldova","Monaco","Mongolia","Montenegro","Montserrat","Morocco","Mozambique","Myanmar","Namibia","Nauru","Nepal","Netherlands","Netherlands Antilles","New Caledonia","New Zealand","Nicaragua","Niger","Nigeria","Niue","Norfolk Island","North Korea","North Macedonia","Northern Mariana Islands","Norway","Oman","Pakistan","Palau","Palestine","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Pitcairn Islands","Poland","Portugal","Puerto Rico","Qatar","Reunion","Romania","Russia","Rwanda","Saint Helena","Saint Kitts and Nevis","Saint Lucia","Saint Pierre and Miquelon","Saint Vincent and the Grenadines","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone","Singapore","Slovakia","Slovenia","Somalia","South Africa","South Georgia and the South Sandwich Islands","South Korea","Spain","Sri Lanka","Sudan","Suriname","Svalbard and Jan Mayen","Sweden","Switzerland","Syria","Taiwan","Tajikistan","Tanzania","Thailand","Timor-Leste","Togo","Tonga","Trinidad and Tobago","Tunisia","Turkey","Turkmenistan","Turks and Caicos Islands","Tuvalu","Uganda","Ukraine","United Arab Emirates","United Kingdom","United States","United States Virgin Islands","Uruguay","Uzbekistan","Vanuatu","Vatican City","Venezuela","Vietnam","Wallis and Futuna","Yemen","Zambia","Zimbabwe"
    ];

    const countryNameMapping = {
        'T√ºrkiye': 'Turkey', 'Turquie': 'Turkey', 'Turqu√≠a': 'Turkey', '–¢—É—Ä—Ü–∏—è': 'Turkey',
        'Myanmar': 'Myanmar', 'Burma': 'Myanmar', 'Czechia': 'Czech Republic',
        'The Netherlands': 'Netherlands', 'Nederland': 'Netherlands', 'Pays-Bas': 'Netherlands',
        'United Kingdom': 'United Kingdom', 'UK': 'United Kingdom', 'Great Britain': 'United Kingdom', 'GB': 'United Kingdom',
        'USA': 'United States', 'US': 'United States', '√âtats-Unis': 'United States',
        'South Korea': 'South Korea', 'Korea': 'South Korea', 'North Korea': 'North Korea',
        'Russia': 'Russia', 'Russian Federation': 'Russia', '–†–æ—Å—Å–∏—è': 'Russia',
        'Iran': 'Iran', 'Syria': 'Syria', 'Libya': 'Libya', 'Vatican': 'Vatican City', 'Holy See': 'Vatican City'
    };

    function populateCountrySelects() {
        const departureSelect = document.getElementById('departure-country');
        const destinationSelect = document.getElementById('destination-country');
        const defaultOption = '--S√©lectionner un Pays--';

        const optionsHTML = `<option value="">${defaultOption}</option>` +
            countriesFR.map((c, i) => {
                const enValue = countriesEN[countriesFR.indexOf(c)] || c;
                return `<option value="${enValue}">${c}</option>`;
            }).join('');

        departureSelect.innerHTML = optionsHTML;
        destinationSelect.innerHTML = optionsHTML;
    }
    populateCountrySelects();

    const departureCountrySelect = document.getElementById('departure-country');
    const destinationCountrySelect = document.getElementById('destination-country');

    window.countryOptionsCache = {
        departure: Array.from(departureCountrySelect.options).filter(opt => opt.value).map(opt => ({ value: opt.value, label: opt.text })),
        destination: Array.from(destinationCountrySelect.options).filter(opt => opt.value).map(opt => ({ value: opt.value, label: opt.text }))
    };

    window.departureChoice = new Choices(departureCountrySelect, choiceOptions);
    window.destinationChoice = new Choices(destinationCountrySelect, choiceOptions);

    function autoSelectCountry(country, choicesInstance, countrySelect, countryMap = null, countryShort = null) {
        let mappedCountry = countryNameMapping[country] || country;
        let availableChoices = choicesInstance.store?.choices?.length > 0 ? choicesInstance.store.choices :
            (countrySelect.id === 'departure-country' ? window.countryOptionsCache.departure : window.countryOptionsCache.destination);

        let foundChoice = availableChoices.find(choice => choice.value === mappedCountry || choice.label === country);
        if (!foundChoice && countryShort) {
            foundChoice = availableChoices.find(choice => String(choice.value).toLowerCase() === countryShort.toLowerCase() || String(choice.label).toLowerCase() === countryShort.toLowerCase());
        }
        if (!foundChoice) {
            const countryLower = mappedCountry.toLowerCase();
            foundChoice = availableChoices.find(choice => String(choice.value).toLowerCase().includes(countryLower) || String(choice.label).toLowerCase().includes(countryLower));
        }

        if (foundChoice && choicesInstance) {
            if (typeof choicesInstance.setValue === 'function') {
                try { choicesInstance.setValue([foundChoice.value]); return; } catch(e) {}
            }
            if (typeof choicesInstance.setChoiceByValue === 'function') {
                try { choicesInstance.setChoiceByValue(foundChoice.value); return; } catch(e) {}
            }
        }
    }
    window.autoSelectCountry = autoSelectCountry;

    const phoneInput = document.getElementById('phone');
    const whatsappInput = document.getElementById('whatsapp');
    const itiOptions = {
        utilsScript: "https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/js/utils.js",
        preferredCountries: ['fr', 'us', 'gb', 'ca', 'au'],
        separateDialCode: true
    };
    const phoneIti = window.intlTelInput(phoneInput, itiOptions);
    const whatsappIti = window.intlTelInput(whatsappInput, itiOptions);

    const page1 = document.getElementById('page-1');
    const page2 = document.getElementById('page-2');
    const page3 = document.getElementById('page-3');
    const page4 = document.getElementById('page-4');
    const petFormsContainer = document.getElementById('pet-forms-container');
    const form = document.getElementById('pet-form');
    const travelOption = document.getElementById('travel-option');
    const contextField = document.getElementById('context-field');
    const contextRadioButtons = document.querySelectorAll('input[name="context"]');
    const otherMeansField = document.getElementById('other-means-field');
    const otherContextTextInput = document.getElementById('other-context-text');
    let petIdCounter = 0;
    const MAX_PETS = 9;

    function createPetForm() {
        const currentPetCount = document.querySelectorAll('.pet-form').length;
        if (currentPetCount >= MAX_PETS) {
            alert(`Vous avez atteint la limite maximale de ${MAX_PETS} animaux.`);
            return;
        }

        petIdCounter++;
        const petForm = document.createElement('div');
        petForm.classList.add('pet-form');
        petForm.dataset.id = petIdCounter;

        const animalTypeLabels = {
            'Cat': 'Chat',
            'Dog': 'Chien',
            'Bird': 'Oiseau',
            'Rabbit': 'Lapin',
            'NAC': 'NAC',
            'Others': 'Autres'
        };

        const animalTypeOptions = Object.keys(breedsFR).map(type =>
            `<option value="${type}">${animalTypeLabels[type] || type}</option>`
        ).join('');

        petForm.innerHTML = `
            <h4>Animal ${petIdCounter}</h4>
            <label class="title-label">Type d'animal <span style="color: var(--danger-color);">*</span></label>
            <select class="animal-type-select" required>
                <option value="">--Choisir--</option>
                ${animalTypeOptions}
            </select>
            <div class="breed-container" style="display: none;">
                <label class="title-label">Race <span style="color: var(--danger-color);">*</span></label>
                <select class="breed-select"></select>
            </div>
            <label class="title-label">√Çge (mois) <span style="color: var(--danger-color);">*</span></label>
            <input type="text" class="age-input" required placeholder="Ex: 12">
            <label class="title-label">Poids (kg) <span style="color: var(--danger-color);">*</span></label>
            <input type="text" class="weight-input" required placeholder="Ex: 5.5">
            <div class="pet-actions">
                <button type="button" class="btn-remove-pet">üóëÔ∏è Supprimer</button>
            </div>
        `;

        petFormsContainer.appendChild(petForm);

        const animalTypeSelect = petForm.querySelector('.animal-type-select');
        const breedContainer = petForm.querySelector('.breed-container');
        const breedSelect = petForm.querySelector('.breed-select');
        const ageInput = petForm.querySelector('.age-input');
        const weightInput = petForm.querySelector('.weight-input');

        animalTypeSelect.addEventListener('change', (e) => {
            const selectedType = e.target.value;
            if (selectedType && breedsFR[selectedType]) {
                breedSelect.innerHTML = `<option value="">--Select--</option>` +
                    breedsFR[selectedType].map(b => `<option value="${b}">${b}</option>`).join('');
                breedContainer.style.display = 'block';
            } else {
                breedContainer.style.display = 'none';
            }
        });

        petForm.querySelector('.btn-remove-pet').addEventListener('click', () => {
            if (document.querySelectorAll('.pet-form').length <= 1) {
                alert("Impossible de supprimer le dernier animal.");
                return;
            }
            petForm.remove();
            updatePetLimitUI();
        });

        ageInput.addEventListener('input', () => { ageInput.value = ageInput.value.replace(/[^0-9]/g, ''); });
        weightInput.addEventListener('input', () => {
            weightInput.value = weightInput.value.replace(/[^0-9.]/g, '');
            const parts = weightInput.value.split('.');
            if (parts.length > 2) weightInput.value = parts[0] + '.' + parts.slice(1).join('');
        });

        updatePetLimitUI();
    }

    function updatePetLimitUI() {
        const petForms = document.querySelectorAll('.pet-form');
        const petCount = petForms.length;
        const limitMessage = document.getElementById('pet-limit-message');
        const addPetBtn = document.getElementById('add-pet-btn');
        const petCountField = document.getElementById('pet-count');

        if (petCountField) {
            petCountField.value = petCount;
        }

        if (limitMessage) {
            limitMessage.style.display = petCount >= MAX_PETS ? 'block' : 'none';
        }
        if (addPetBtn) {
            addPetBtn.disabled = petCount >= MAX_PETS;
        }

        console.log('üêæ Pet count updated:', petCount);
    }

    createPetForm();

    document.getElementById('add-pet-btn')?.addEventListener('click', createPetForm);

    document.getElementById('next-page-1-btn')?.addEventListener('click', () => {
        if (validatePage(page1)) {
            page1.style.display = 'none';
            page2.style.display = 'block';
        }
    });

    document.getElementById('prev-page-2-btn')?.addEventListener('click', () => {
        page2.style.display = 'none';
        page1.style.display = 'block';
    });

    document.getElementById('next-page-2-btn')?.addEventListener('click', () => {
        const departureCountryValue = window.departureChoice?.getValue(true);
        const destinationCountryValue = window.destinationChoice?.getValue(true);
        if (!departureCountryValue) { alert('Veuillez s√©lectionner un pays de d√©part.'); return; }
        if (!destinationCountryValue) { alert('Veuillez s√©lectionner un pays de destination.'); return; }
        if (validatePage(page2)) {
            page2.style.display = 'none';
            page3.style.display = 'block';
            checkQualification();
        }
    });

    document.getElementById('prev-page-3-btn')?.addEventListener('click', () => {
        page3.style.display = 'none';
        page2.style.display = 'block';
    });

    document.getElementById('next-page-3-btn')?.addEventListener('click', () => {
        if (validatePage(page3)) {
            page3.style.display = 'none';
            page4.style.display = 'block';
        }
    });

    document.getElementById('prev-page-4-btn')?.addEventListener('click', () => {
        page4.style.display = 'none';
        page3.style.display = 'block';
    });

    function validatePage(pageElement) {
        let isValid = true;

        if (pageElement.id === 'page-1') {
            const petForms = pageElement.querySelectorAll('.pet-form');
            for (const petForm of petForms) {
                const animalTypeSelect = petForm.querySelector('.animal-type-select');
                const breedSelect = petForm.querySelector('.breed-select');
                const ageInput = petForm.querySelector('.age-input');
                const weightInput = petForm.querySelector('.weight-input');
                const breedContainer = petForm.querySelector('.breed-container');

                if (!animalTypeSelect.value) { animalTypeSelect.classList.add('error'); isValid = false; }
                else animalTypeSelect.classList.remove('error');

                if (breedContainer.style.display !== 'none' && !breedSelect.value) {
                    breedSelect.classList.add('error'); isValid = false;
                } else breedSelect.classList.remove('error');

                if (!ageInput.value) { ageInput.classList.add('error'); isValid = false; }
                else ageInput.classList.remove('error');

                if (!weightInput.value) { weightInput.classList.add('error'); isValid = false; }
                else weightInput.classList.remove('error');
            }
            if (!isValid) { alert('Veuillez remplir tous les champs obligatoires.'); return false; }
        }

        if (pageElement.id === 'page-4') {
            const firstName = document.getElementById('first-name');
            const lastName = document.getElementById('last-name');
            const email = document.getElementById('email');
            const phone = document.getElementById('phone');
            const consent = document.getElementById('consent');

            if (!firstName.value.trim()) { alert('Veuillez entrer votre pr√©nom.'); return false; }
            if (!lastName.value.trim()) { alert('Veuillez entrer votre nom.'); return false; }
            if (!email.value.trim()) { alert('Veuillez entrer votre email.'); return false; }
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value.trim())) { alert('Email invalide.'); return false; }
            if (!phoneIti.isValidNumber()) { alert('Num√©ro de t√©l√©phone invalide.'); return false; }
            if (!consent.checked) { alert('Veuillez accepter les conditions.'); return false; }
        }

        if (pageElement.id === 'page-3' && travelOption.value === 'alone') {
            const selectedContext = document.querySelector('input[name="context"]:checked');
            if (!selectedContext) { alert('Veuillez s√©lectionner un contexte.'); return false; }
            if (selectedContext.value === 'others' && !otherContextTextInput.value.trim()) {
                alert('Veuillez pr√©ciser le contexte.'); return false;
            }
        }

        return isValid;
    }

    travelOption?.addEventListener('change', () => {
        if (travelOption.value === 'alone') {
            contextField.style.display = 'block';
            contextRadioButtons.forEach(r => r.required = true);
        } else {
            contextField.style.display = 'none';
            contextRadioButtons.forEach(r => r.required = false);
        }
    });

    contextRadioButtons.forEach(radio => {
        radio.addEventListener('change', () => {
            otherMeansField.style.display = radio.value === 'others' ? 'block' : 'none';
            otherContextTextInput.required = radio.value === 'others';
        });
    });

    function checkQualification() {
        const destinationCountry = document.getElementById('destination-country').value;
        const petForms = document.querySelectorAll('.pet-form');
        let isAtLeastOnePetQualified = false;

        petForms.forEach(petForm => {
            const animalType = petForm.querySelector('.animal-type-select').value;
            const breed = petForm.querySelector('.breed-select').value;

            if (animalType === 'Dog' && qualifiedDogsFR.includes(breed)) isAtLeastOnePetQualified = true;
            else if (animalType === 'Cat' && qualifiedCatsFR.includes(breed)) isAtLeastOnePetQualified = true;
        });

        const isCountryQualified = qualifiedCountries.includes(destinationCountry);

        if (isAtLeastOnePetQualified || isCountryQualified) {
            document.getElementById('travel-options-group').style.display = 'none';
            travelOption.required = false;
        } else {
            document.getElementById('travel-options-group').style.display = 'block';
            travelOption.required = true;
        }
    }

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!validatePage(page4)) return;

        const data = { pets: [] };
        document.querySelectorAll('.pet-form').forEach(pForm => {
            data.pets.push({
                animal_type: pForm.querySelector('.animal-type-select').value,
                breed: pForm.querySelector('.breed-select').value,
                age: pForm.querySelector('.age-input').value,
                weight: pForm.querySelector('.weight-input').value
            });
        });

        data['departure-street'] = document.getElementById('departure-street').value;
        data['departure-city'] = document.getElementById('departure-city').value;
        data['departure-country'] = document.getElementById('departure-country').value;
        data['destination-street'] = document.getElementById('destination-street').value;
        data['destination-city'] = document.getElementById('destination-city').value;
        data['destination-country'] = document.getElementById('destination-country').value;
        data['departure-date'] = document.getElementById('departure-date').value;
        data['travel-option'] = travelOption.value;
        data['context'] = document.querySelector('input[name="context"]:checked')?.value || '';
        data['other-context'] = document.getElementById('other-context-text').value;
        data['additional-info'] = document.getElementById('additional-info').value;
        data['first-name'] = document.getElementById('first-name').value;
        data['last-name'] = document.getElementById('last-name').value;
        data['email'] = document.getElementById('email').value;
        data['phone'] = phoneIti.getNumber();
        data['whatsapp'] = whatsappInput.value ? whatsappIti.getNumber() : '';
        data['consent'] = document.getElementById('consent').checked ? 'true' : 'false';
        data['pet_count'] = document.getElementById('pet-count').value;

        const petCount = parseInt(data['pet_count']);
        const petTypes = [];
        const petAges = [];
        const petWeights = [];
        const petBreeds = [];

        document.querySelectorAll('.pet-form').forEach((pForm, index) => {
            const animalType = pForm.querySelector('.animal-type-select').value.toLowerCase();
            const breed = pForm.querySelector('.breed-select').value;
            const age = pForm.querySelector('.age-input').value;
            const weight = pForm.querySelector('.weight-input').value;

            const breedValue = breed.toLowerCase().replace(/[^a-z0-9]+/g, '_').replace(/_+/g, '_').replace(/^_|_$/g, '');

            petTypes.push(animalType);
            petAges.push(age);
            petWeights.push(weight);
            petBreeds.push(breedValue);
        });

        data['pet_1_type'] = petTypes[0] || '';
        data['pet_2_type'] = petTypes[1] || '';
        data['pet_3_type'] = petTypes[2] || '';
        data['pet_4_type'] = petTypes[3] || '';
        data['pet_5_type'] = petTypes[4] || '';
        data['pet_6_type'] = petTypes[5] || '';
        data['pet_7_type'] = petTypes[6] || '';
        data['pet_8_type'] = petTypes[7] || '';
        data['pet_9_type'] = petTypes[8] || '';

        data['pet_1_age'] = petAges[0] || '';
        data['pet_2_age'] = petAges[1] || '';
        data['pet_3_age'] = petAges[2] || '';
        data['pet_4_age'] = petAges[3] || '';
        data['pet_5_age'] = petAges[4] || '';
        data['pet_6_age'] = petAges[5] || '';
        data['pet_7_age'] = petAges[6] || '';
        data['pet_8_age'] = petAges[7] || '';
        data['pet_9_age'] = petAges[8] || '';

        data['pet_1_weight'] = petWeights[0] || '';
        data['pet_2_weight'] = petWeights[1] || '';
        data['pet_3_weight'] = petWeights[2] || '';
        data['pet_4_weight'] = petWeights[3] || '';
        data['pet_5_weight'] = petWeights[4] || '';
        data['pet_6_weight'] = petWeights[5] || '';
        data['pet_7_weight'] = petWeights[6] || '';
        data['pet_8_weight'] = petWeights[7] || '';
        data['pet_9_weight'] = petWeights[8] || '';

        data['pet_1_breed'] = petBreeds[0] || '';
        data['pet_2_breed'] = petBreeds[1] || '';
        data['pet_3_breed'] = petBreeds[2] || '';
        data['pet_4_breed'] = petBreeds[3] || '';
        data['pet_5_breed'] = petBreeds[4] || '';
        data['pet_6_breed'] = petBreeds[5] || '';
        data['pet_7_breed'] = petBreeds[6] || '';
        data['pet_8_breed'] = petBreeds[7] || '';
        data['pet_9_breed'] = petBreeds[8] || '';

        console.log('üì¶ Form data prepared for submission:', data);
        console.log('üêæ Pet count:', data['pet_count']);
        console.log('üêï Pet types:', petTypes);
        console.log('ü¶¥ Pet breeds:', petBreeds);

        const submitBtn = form.querySelector('button[type="submit"]');
        const originalBtnText = submitBtn.textContent;
        submitBtn.disabled = true;
        submitBtn.textContent = "Envoi en cours...";

        try {
            const response = await fetch('https://forms.worldbaggagenetwork.com/wp-json/pet-transport/v1/request', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data),
            });

            if (response.ok) {
                if (typeof window.submitToHubSpot === 'function' && typeof window.hubspotConfig !== 'undefined') {
                    try {
                        await window.submitToHubSpot(data, window.hubspotConfig);
                        console.log('‚úÖ HubSpot submission successful');
                    } catch (hubspotError) {
                        console.error('HubSpot error:', hubspotError);
                    }
                }

                alert("Demande soumise avec succ√®s!");
                form.reset();
                window.location.href = 'remerciement.html';
            } else {
                throw new Error('Submission failed');
            }
        } catch (error) {
            console.error('Submission error:', error);
            alert("La soumission a √©chou√©. Veuillez r√©essayer.");
            submitBtn.disabled = false;
            submitBtn.textContent = originalBtnText;
        }
    });

    let departureAutocomplete = null;
    let destinationAutocomplete = null;
    let departureCityAutocomplete = null;
    let destinationCityAutocomplete = null;

    function initializeGooglePlaces() {
        if (typeof google === 'undefined' || !google.maps || !google.maps.places) {
            console.error('‚ùå Google Places API not loaded');
            setTimeout(initializeGooglePlaces, 100);
            return;
        }
        console.log('‚úÖ Google Places API loaded');

        const departureStreetInput = document.getElementById('departure-street');
        const destinationStreetInput = document.getElementById('destination-street');
        const departureCityInput = document.getElementById('departure-city');
        const destinationCityInput = document.getElementById('destination-city');

        function getCountryCode() {
            const departureCountry = window.departureChoice?.getValue(true) || '';
            const destinationCountry = window.destinationChoice?.getValue(true) || '';

            const countryToCode = {
                'France': 'fr', 'United States': 'us', 'United Kingdom': 'gb', 'Canada': 'ca',
                'Australia': 'au', 'Germany': 'de', 'Spain': 'es', 'Italy': 'it', 'Netherlands': 'nl',
                'Belgium': 'be', 'Switzerland': 'ch', 'Austria': 'at', 'Portugal': 'pt',
                'Mauritius': 'mu', 'New Zealand': 'nz', 'Singapore': 'sg', 'Hong Kong': 'hk',
                'United Arab Emirates': 'ae', 'South Africa': 'za'
            };
            const code = countryToCode[departureCountry] || countryToCode[destinationCountry];
            return code || null;
        }

        if (departureStreetInput) {
            const countryCode = getCountryCode();
            const options = {
                fields: ['address_components', 'formatted_address'],
                types: ['address'],
                componentRestrictions: countryCode ? { country: countryCode } : undefined
            };
            departureAutocomplete = new google.maps.places.Autocomplete(departureStreetInput, options);

            departureAutocomplete.addListener('place_changed', () => {
                const place = departureAutocomplete.getPlace();
                if (!place || !place.address_components) return;

                console.log('üìç Departure place selected:', place.formatted_address);

                let streetNumber = '', route = '', city = '', country = '';

                for (const component of place.address_components) {
                    const types = component.types;
                    if (types.includes('street_number')) streetNumber = component.long_name;
                    if (types.includes('route')) route = component.long_name;
                    if (types.includes('locality') || types.includes('postal_town')) city = component.long_name;
                    if (types.includes('country')) country = component.long_name;
                }

                if (departureStreetInput) departureStreetInput.value = (streetNumber + ' ' + route).trim();
                if (departureCityInput) departureCityInput.value = city;
                if (country && window.departureChoice) {
                    autoSelectCountry(country, window.departureChoice, document.getElementById('departure-country'));
                }

                console.log('‚úÖ Departure address filled:', departureStreetInput.value, city, country);
            });
        }

        if (destinationStreetInput) {
            const countryCode = getCountryCode();
            const options = {
                fields: ['address_components', 'formatted_address'],
                types: ['address'],
                componentRestrictions: countryCode ? { country: countryCode } : undefined
            };
            destinationAutocomplete = new google.maps.places.Autocomplete(destinationStreetInput, options);

            destinationAutocomplete.addListener('place_changed', () => {
                const place = destinationAutocomplete.getPlace();
                if (!place || !place.address_components) return;

                console.log('üìç Destination place selected:', place.formatted_address);

                let streetNumber = '', route = '', city = '', country = '';

                for (const component of place.address_components) {
                    const types = component.types;
                    if (types.includes('street_number')) streetNumber = component.long_name;
                    if (types.includes('route')) route = component.long_name;
                    if (types.includes('locality') || types.includes('postal_town')) city = component.long_name;
                    if (types.includes('country')) country = component.long_name;
                }

                if (destinationStreetInput) destinationStreetInput.value = (streetNumber + ' ' + route).trim();
                if (destinationCityInput) destinationCityInput.value = city;
                if (country && window.destinationChoice) {
                    autoSelectCountry(country, window.destinationChoice, document.getElementById('destination-country'));
                }

                console.log('‚úÖ Destination address filled:', destinationStreetInput.value, city, country);
            });
        }

        if (departureCityInput) {
            const options = {
                fields: ['address_components', 'formatted_address'],
                types: ['(cities)']
            };
            departureCityAutocomplete = new google.maps.places.Autocomplete(departureCityInput, options);

            departureCityAutocomplete.addListener('place_changed', () => {
                const place = departureCityAutocomplete.getPlace();
                if (!place || !place.address_components) return;

                for (const component of place.address_components) {
                    if (component.types.includes('country')) {
                        autoSelectCountry(component.long_name, window.departureChoice, document.getElementById('departure-country'));
                    }
                }
            });
        }

        if (destinationCityInput) {
            const options = {
                fields: ['address_components', 'formatted_address'],
                types: ['(cities)']
            };
            destinationCityAutocomplete = new google.maps.places.Autocomplete(destinationCityInput, options);

            destinationCityAutocomplete.addListener('place_changed', () => {
                const place = destinationCityAutocomplete.getPlace();
                if (!place || !place.address_components) return;

                for (const component of place.address_components) {
                    if (component.types.includes('country')) {
                        autoSelectCountry(component.long_name, window.destinationChoice, document.getElementById('destination-country'));
                    }
                }
            });
        }

        const page2 = document.getElementById('page-2');
        if (page2) {
            const observer = new MutationObserver((mutations) => {
                if (page2.style.display !== 'none') {
                    setTimeout(() => {
                        const countryCode = getCountryCode();
                        if (departureAutocomplete && countryCode) {
                            departureAutocomplete.set('componentRestrictions', { country: countryCode });
                        }
                        if (destinationAutocomplete && countryCode) {
                            destinationAutocomplete.set('componentRestrictions', { country: countryCode });
                        }
                    }, 200);
                }
            });
            observer.observe(page2, { attributes: true, attributeFilter: ['style'] });
        }
    };

    initializeGooglePlaces();
});
    </script>
</body>
</html>
